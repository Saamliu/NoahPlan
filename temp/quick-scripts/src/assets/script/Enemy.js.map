{"version":3,"sources":["assets\\script\\Enemy.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Player from \"./Player\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class Enemy extends cc.Component {\n\n    scrWidth: number;\n    scrHeight: number;\n    isDead: boolean = false;\n\n    @property\n    private hp: number = 3;\n    private targetPosition: cc.Vec3;\n\n    @property(cc.Prefab)\n    NdBullet: cc.Prefab = null;\n    @property\n    speed: number = 180;\n    @property\n    time: number = 2;\n\n\n    onLoad() {\n        this.scrWidth = cc.view.getCanvasSize().width;\n        this.scrHeight = cc.view.getCanvasSize().height;\n        cc.director.getCollisionManager().enabled = true;\n    }\n\n    start() {\n        // this.node.y = this.scrHeight + this.node.height;\n        // this.node.x = this.node.width / 2 + Math.random() * (this.scrWidth - this.node.width);\n    }\n\n    update(dt) {\n        if (this.isDead) {\n            return;\n        }\n        if (this.time < 0) {\n            this.shoot();\n            this.time = 2;\n            console.log(\"1\");\n        }\n        \n        this.time -= dt;\n        this.node.x -= this.speed * dt;\n        if (this.node.x < -1000) {\n            this.node.removeFromParent(true);\n            this.destroy();\n        }\n    }\n\n    // 处理碰撞事件layer\n    onCollisionEnter(other, self) {\n        if (other.node.group === 'Player') {\n            this.node.destroy();\n        }\n        if (other.node.group === 'Bullet') {\n            this.hp -= Player.attcked; // 根据需要调整伤害值\n            if (this.hp <= 0) {\n                // 敌人已经死亡，可以在这里添加敌人死亡的逻辑\n                this.node.destroy();\n            }\n        }\n    }\n\n    private shoot() {\n        if (this.isDead) {\n            return;\n        }\n    \n        // 获取玩家节点\n        const playerNode = cc.find('Canvas/UIManager/Game/Player');\n        if (!playerNode) {\n            return; // 玩家节点不存在，不发射子弹\n        }\n    \n        // 计算玩家相对于敌人的位置向量\n        const playerPosition = playerNode.position;\n        const enemyPosition = this.node.position;\n        const direction = playerPosition.sub(enemyPosition);\n    \n        // 计算敌人和玩家之间的角度\n        const angle = direction.signAngle(cc.Vec2.RIGHT);\n    \n        // 只有当角度合理时才发射子弹\n        const maxAngle = Math.PI / 2 + Math.PI / 12; //165度内发射\n        if (Math.abs(angle) > maxAngle) {\n            // 实例化子弹预制体\n            const bulletNode = cc.instantiate(this.NdBullet);\n    \n            // 设置子弹的位置\n            bulletNode.position = this.node.position;\n    \n            // 设置子弹的方向，可以通过旋转子弹节点或设置速度来实现\n            const bulletScript = bulletNode.getComponent('EnemyBullet'); \n            if (bulletScript) {\n                bulletScript.setDirection(direction.normalize()); // 在子弹组件中设置归一化的方向\n            }\n    \n            // 将子弹添加到场景中\n            this.node.parent.addChild(bulletNode);\n        }\n    }\n    \n    \n    \n    // onCollisionEnter(other, self) {\n    //     if (other.tag == 9 && !this.isDead) {\n    //         this.die();\n    //         other.getComponent(Bullet).die();\n    //     } else if (other.tag == 0 && !this.isDead) {\n    //         cc.game.pause;\n    //         alert(\"gameover\");\n    //         cc.audioEngine.stopMusic;\n    //     }\n    // }\n}\n"]}